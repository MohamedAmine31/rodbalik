<div class="content">
  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Gestion des Catégories</h1>
      <p class="page-subtitle">Organisez et gérez vos catégories de signalements</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary-gradient" (click)="openCreateModal()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"/>
        </svg>
        <span>Nouvelle Catégorie</span>
      </button>
    </div>
  </div>

  <!-- Main Card -->
  <div class="data-card">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner-large"></div>
      <p class="loading-text">Chargement des catégories...</p>
    </div>

    <!-- Categories Grid -->
    <div *ngIf="!isLoading && categories.length > 0" class="categories-grid">
      <div class="category-card-modern" *ngFor="let category of categories">
        <div class="category-card-header">
          <div class="category-icon-circle" [style.background]="category.color + '15'">
            <i [class]="category.icon || 'bi bi-tag-fill'" 
               [style.color]="category.color"></i>
          </div>
          <div class="category-actions-top">
            <button class="action-btn-minimal" title="Modifier" (click)="editCategory(category)">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/>
                <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/>
              </svg>
            </button>
            <button class="action-btn-minimal danger" title="Supprimer" (click)="deleteCategory(category.id)">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="category-card-body">
          <h3 class="category-title">{{ category.name }}</h3>
          <p class="category-desc">{{ category.description }}</p>
        </div>

        <div class="category-card-footer">
          <div class="color-indicator-group">
            <span class="color-dot" [style.background]="category.color"></span>
            <span class="color-code">{{ category.color }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && categories.length === 0" class="empty-state-modern">
      <div class="empty-icon-wrapper">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
        </svg>
      </div>
      <h3 class="empty-title">Aucune catégorie</h3>
      <p class="empty-description">
        Commencez par créer votre première catégorie pour organiser vos signalements.
      </p>
      <button class="btn-primary-gradient" (click)="openCreateModal()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"/>
        </svg>
        Créer une catégorie
      </button>
    </div>
  </div>
</div>

<!-- Create Category Modal -->
<div class="modal-overlay-modern" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal-dialog-modern modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header-modern">
      <div class="modal-header-left">
        <div class="modal-icon-wrapper">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div>
          <h2 class="modal-title-modern">Nouvelle Catégorie</h2>
          <p class="modal-subtitle-modern">Créez une catégorie pour organiser vos signalements</p>
        </div>
      </div>
      <button class="modal-close-modern" (click)="closeCreateModal()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>

    <div class="modal-body-modern">
      <form class="form-modern">
        <!-- General Information Section -->
        <div class="form-section-modern">
          <div class="section-header-modern">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
            </svg>
            <span>Informations Générales</span>
          </div>

          <div class="form-row-modern">
            <div class="form-col-modern form-col-8">
              <div class="form-group-modern">
                <label class="form-label-modern">
                  Nom de la catégorie
                  <span class="required-star">*</span>
                </label>
                <div class="input-with-icon">
                  <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                  </svg>
                  <input type="text" class="form-input-modern" 
                         [(ngModel)]="newCategory.name" name="name"
                         placeholder="Ex: Propreté, Sécurité, Éclairage public...">
                </div>
              </div>
            </div>

            <div class="form-col-modern form-col-4">
              <div class="form-group-modern">
                <label class="form-label-modern">Couleur</label>
                <div class="color-picker-wrapper">
                  <input type="color" class="color-picker-input" 
                         [(ngModel)]="newCategory.color" name="color">
                  <input type="text" class="color-text-input" 
                         [(ngModel)]="newCategory.color" name="colorHex"
                         placeholder="#3B82F6">
                </div>
              </div>
            </div>
          </div>

          <div class="form-group-modern">
            <label class="form-label-modern">
              Description
              <span class="required-star">*</span>
            </label>
            <textarea class="form-textarea-modern" rows="4"
                      [(ngModel)]="newCategory.description" name="description"
                      placeholder="Décrivez l'objectif et l'utilisation de cette catégorie..."></textarea>
            <small class="form-hint">Une description claire aide les utilisateurs à choisir la bonne catégorie</small>
          </div>
        </div>

        <!-- Icon Selection Section -->
        <div class="form-section-modern">
          <div class="section-header-modern">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
            </svg>
            <span>Icône Représentative</span>
          </div>

          <div class="icon-selector-modern">
            <div class="icon-info-badge">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.5 2C11.63 2 11.74 2.05 11.84 2.14L14.84 5.14C14.95 5.25 15 5.36 15 5.5V9H20.5C20.63 9 20.74 9.05 20.84 9.14L23.84 12.14C23.95 12.25 24 12.36 24 12.5V20.5C24 20.63 23.95 20.74 23.84 23.84L20.84 20.84C20.74 20.95 20.63 21 20.5 21H3.5C3.37 21 3.26 20.95 3.16 20.84L0.16 17.84C0.0500001 17.74 0 17.63 0 17.5V3.5C0 3.37 0.0500001 3.26 0.16 3.16L3.16 0.16C3.26 0.0500001 3.37 0 3.5 0H11.5V2M14 6L12 4V6H14M21 13L19 11V13H21Z"/>
              </svg>
              <span>Bootstrap Icons</span>
            </div>
            <p class="icon-helper-text">Sélectionnez une icône pour identifier visuellement la catégorie</p>

            <div class="icon-grid-modern">
              <button type="button" 
                      class="icon-item-modern" 
                      *ngFor="let icon of currentIcons"
                      [class.selected]="newCategory.icon === icon"
                      (click)="selectIcon(icon)"
                      [title]="icon">
                <i [class]="icon"></i>
              </button>
            </div>

            <div class="icon-preview-section" *ngIf="newCategory.icon">
              <label class="preview-label">Icône sélectionnée :</label>
              <div class="preview-container">
                <div class="preview-icon-display" [style.background]="newCategory.color + '15'">
                  <i [class]="newCategory.icon" [style.color]="newCategory.color"></i>
                </div>
                <code class="icon-code">{{ newCategory.icon }}</code>
              </div>
            </div>

            <div class="form-group-modern">
              <label class="form-label-modern">Ou saisissez le nom de l'icône :</label>
              <div class="input-with-icon">
                <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                <input type="text" class="form-input-modern" 
                       [(ngModel)]="newCategory.icon" name="icon"
                       placeholder="bi bi-house-fill">
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer-modern">
      <button class="btn-secondary-modern" (click)="closeCreateModal()">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
        </svg>
        Annuler
      </button>
      <button class="btn-primary-modern" (click)="createCategory()"
              [disabled]="!newCategory.name || !newCategory.description">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        Créer la catégorie
      </button>
    </div>
  </div>
</div>

<!-- Edit Category Modal -->
<div class="modal-overlay-modern" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-dialog-modern modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header-modern">
      <div class="modal-header-left">
        <div class="modal-icon-wrapper edit">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
            <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/>
            <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div>
          <h2 class="modal-title-modern">Modifier la Catégorie</h2>
          <p class="modal-subtitle-modern">Modifiez les informations de la catégorie</p>
        </div>
      </div>
      <button class="modal-close-modern" (click)="closeEditModal()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>

    <div class="modal-body-modern" *ngIf="editingCategory">
      <form class="form-modern">
        <!-- General Information Section -->
        <div class="form-section-modern">
          <div class="section-header-modern">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
            </svg>
            <span>Informations Générales</span>
          </div>

          <div class="form-row-modern">
            <div class="form-col-modern form-col-8">
              <div class="form-group-modern">
                <label class="form-label-modern">
                  Nom de la catégorie
                  <span class="required-star">*</span>
                </label>
                <div class="input-with-icon">
                  <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                  </svg>
                  <input type="text" class="form-input-modern" 
                         [(ngModel)]="editingCategory.name" name="editName"
                         placeholder="Ex: Propreté, Sécurité, Éclairage public...">
                </div>
              </div>
            </div>

            <div class="form-col-modern form-col-4">
              <div class="form-group-modern">
                <label class="form-label-modern">Couleur</label>
                <div class="color-picker-wrapper">
                  <input type="color" class="color-picker-input" 
                         [(ngModel)]="editingCategory.color" name="editColor">
                  <input type="text" class="color-text-input" 
                         [(ngModel)]="editingCategory.color" name="editColorHex"
                         placeholder="#3B82F6">
                </div>
              </div>
            </div>
          </div>

          <div class="form-group-modern">
            <label class="form-label-modern">
              Description
              <span class="required-star">*</span>
            </label>
            <textarea class="form-textarea-modern" rows="4"
                      [(ngModel)]="editingCategory.description" name="editDescription"
                      placeholder="Décrivez l'objectif et l'utilisation de cette catégorie..."></textarea>
            <small class="form-hint">Une description claire aide les utilisateurs à choisir la bonne catégorie</small>
          </div>
        </div>

        <!-- Icon Selection Section -->
        <div class="form-section-modern">
          <div class="section-header-modern">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
            </svg>
            <span>Icône Représentative</span>
          </div>

          <div class="icon-selector-modern">
            <div class="icon-info-badge">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.5 2C11.63 2 11.74 2.05 11.84 2.14L14.84 5.14C14.95 5.25 15 5.36 15 5.5V9H20.5C20.63 9 20.74 9.05 20.84 9.14L23.84 12.14C23.95 12.25 24 12.36 24 12.5V20.5C24 20.63 23.95 20.74 23.84 23.84L20.84 20.84C20.74 20.95 20.63 21 20.5 21H3.5C3.37 21 3.26 20.95 3.16 20.84L0.16 17.84C0.0500001 17.74 0 17.63 0 17.5V3.5C0 3.37 0.0500001 3.26 0.16 3.16L3.16 0.16C3.26 0.0500001 3.37 0 3.5 0H11.5V2M14 6L12 4V6H14M21 13L19 11V13H21Z"/>
              </svg>
              <span>Bootstrap Icons</span>
            </div>
            <p class="icon-helper-text">Sélectionnez une icône pour identifier visuellement la catégorie</p>

            <div class="icon-grid-modern">
              <button type="button" 
                      class="icon-item-modern" 
                      *ngFor="let icon of currentIcons"
                      [class.selected]="editingCategory.icon === icon"
                      (click)="editingCategory.icon = icon"
                      [title]="icon">
                <i [class]="icon"></i>
              </button>
            </div>

            <div class="icon-preview-section" *ngIf="editingCategory.icon">
              <label class="preview-label">Icône sélectionnée :</label>
              <div class="preview-container">
                <div class="preview-icon-display" [style.background]="editingCategory.color + '15'">
                  <i [class]="editingCategory.icon" [style.color]="editingCategory.color"></i>
                </div>
                <code class="icon-code">{{ editingCategory.icon }}</code>
              </div>
            </div>

            <div class="form-group-modern">
              <label class="form-label-modern">Ou saisissez le nom de l'icône :</label>
              <div class="input-with-icon">
                <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                <input type="text" class="form-input-modern" 
                       [(ngModel)]="editingCategory.icon" name="editIcon"
                       placeholder="bi bi-house-fill">
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer-modern">
      <button class="btn-secondary-modern" (click)="closeEditModal()">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
        </svg>
        Annuler
      </button>
      <button class="btn-primary-modern" (click)="updateCategory()"
              [disabled]="!editingCategory?.name || !editingCategory?.description">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        Mettre à jour
      </button>
    </div>
  </div>
</div>